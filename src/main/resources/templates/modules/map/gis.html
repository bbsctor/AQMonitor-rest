<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#allmap{width:100%;height:500px;}
		p{margin-left:5px; font-size:14px;}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=CDe0d2784ccc2ec454fc87f68b364cdd"></script>
	<title>纯文本的信息窗口</title>
	<#include "/header.html">
</head>
<body>
	<div id="allmap"></div>
	<p>点击标注点，可查看由纯文本构成的简单型信息窗口</p>
</body>
</html>
<script type="text/javascript">

	var markerArr;
	function init() {
		$.ajax({ //使用JQuery内置的Ajax方法         
			type : "post", //post请求方式
			contentType : "application/json;charset=utf-8",
			async : true, //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
			url : baseURL + '/station/stationinfo/data', //请求发送到ShowInfoIndexServlet处
			dataType : "json", //返回数据形式为json

			success : function(result) {

				//请求成功时执行该函数内容，result即为服务器返回的json对象
				if (result != null && result.length > 0) {
					markerArr = result;
					//loadJScript();
					map_init();
				}
			},
			error : function(errorMsg) {
				//请求失败时执行该函数
				alert(errorMsg);
			}
		});


	}

	function map_init() {
		var map = new BMap.Map("allmap"); // 创建Map实例
		var point = new BMap.Point(108.9685919539, 34.2825215707); //地图中心点，广州市
		map.centerAndZoom(point, 12); // 初始化地图,设置中心点坐标和地图级别。
		map.enableScrollWheelZoom(true); //启用滚轮放大缩小
		var mapType1 = new BMap.MapTypeControl({
			mapTypes : [ BMAP_NORMAL_MAP, BMAP_HYBRID_MAP ]
		});
		var mapType2 = new BMap.MapTypeControl({
			anchor : BMAP_ANCHOR_TOP_RIGHT
		});

		var overView = new BMap.OverviewMapControl();
		var overViewOpen = new BMap.OverviewMapControl({
			isOpen : true,
			anchor : BMAP_ANCHOR_BOTTOM_RIGHT
		});
		var top_left_control = new BMap.ScaleControl({
			anchor : BMAP_ANCHOR_BOTTOM_LEFT
		}); // 左上角，添加比例尺
		var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件


		map.addControl(top_left_control);
		map.addControl(top_left_navigation);
		map.addControl(mapType1); //左上角，默认地图控件
		map.setCurrentCity("西安"); //由于有3D图，需要设置城市哦
		map.addControl(overView); //添加默认缩略地图控件
		map.addControl(overViewOpen); //右下角，打开

		function addMarker(point, id) {
			//alert(id);
			var marker = new BMap.Marker(point);
			marker.id = id;
			map.addOverlay(marker);
			marker.addEventListener("click",getAttr);
			function getAttr(e){
				//var p = marker.getPosition();       //获取marker的位置
				//alert("marker的位置是" + p.lng + "," + p.lat); 
				alert(e.target.id);  
			}
			
		}
		
		
		
		for (var i = 0; i < markerArr.length; i++) {
			var p0 = markerArr[i].point.split(",")[0]; //
			var p1 = markerArr[i].point.split(",")[1]; //按照原数组的point格式将地图点坐标的经纬度分别提出来
			var point = new window.BMap.Point(p0, p1); //循环生成新的地图点
			addMarker(point, markerArr[i].id);
			
		}
	}

	
	window.onload = init;
</script>
